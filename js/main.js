
//Array of products//
let products = [
    {
        id: 1,
        image: "images/products/img1.jpg",
        productName: "pink dress",
        price: "$12",
        category: "Dresses",
        quantity: 1
    }
    ,
    {
        id: 2,
        image: "images/products/img2.jpg",
        productName: "tiger heels",
        price: "$9",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 3,
        image: "images/products/img3.jpg",
        productName: "yellow pants",
        price: "$10",
        category: "Pants",
        quantity: 1
    },
    {
        id: 4,
        image: "images/products/img4.jpg",
        productName: "yellow dress",
        price: "$12",
        category: "Dresses",
        quantity: 1
    },
    {
        id: 5,
        image: "images/products/img5.jpg",
        productName: "sunflower dress",
        price: "$13",
        category: "Dresses",
        quantity: 1
    },
    {
        id: 6,
        image: "images/products/img6.jpg",
        productName: "black heels",
        price: "$8",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 7,
        image: "images/products/img7.jpg",
        productName: "pink bag",
        price: "$8",
        category: "Bags",
        quantity: 1
    },
    {
        id: 8,
        image: "images/products/img8.jpg",
        productName: "colored dress",
        price: "$14",
        category: "Dresses",
        quantity: 1
    },
    {
        id: 9,
        image: "images/products/img9.jpg",
        productName: "white bag",
        price: "$9",
        category: "Bags",
        quantity: 1
    },
    {
        id: 10,
        image: "images/products/img10.jpg",
        productName: "grey pants",
        price: "$12",
        category: "Pants",
        quantity: 1
    },
    {
        id: 11,
        image: "images/products/img11.jpg",
        productName: "bink blouse",
        price: "$12",
        category: "Blouses",
        quantity: 1
    },
    {
        id: 12,
        image: "images/products/img12.jpg",
        productName: "basic t-shirt",
        price: "$10",
        category: "Blouses",
        quantity: 1
    },
    {
        id: 13,
        image: "images/products/img13.jpg",
        productName: "pubbgy pants",
        price: "$12",
        category: "Pants",
        quantity: 1
    }
    ,
    {
        id: 14,
        image: "images/products/img14.jpg",
        productName: "wide leg pants",
        price: "$10",
        category: "Pants",
        quantity: 1
    },
    {
        id: 15,
        image: "images/products/img15.jpg",
        productName: "small bag",
        price: "$6",
        category: "Bags",
        quantity: 1
    },
    {
        id: 16,
        image: "images/products/img16.jpg",
        productName: "beag shoes",
        price: "$12",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 17,
        image: "images/products/img17.jpg",
        productName: "jeans blouse",
        price: "$11",
        category: "Blouses",
        quantity: 1
    },
    {
        id: 18,
        image: "images/products/img18.jpg",
        productName: "black&grey boat",
        price: "$10",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 19,
        image: "images/products/img19.jpg",
        productName: "pinky bag",
        price: "$8",
        category: "Bags",
        quantity: 1
    },
    {
        id: 20,
        image: "images/products/img20.jpg",
        productName: "sporting shoes",
        price: "$15",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 21,
        image: "images/products/img21.jpg",
        productName: "pinky dress",
        price: "$9",
        category: "Dresses",
        quantity: 1
    },
    {
        id: 22,
        image: "images/products/img22.jpg",
        productName: "black boat",
        price: "$13",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 23,
        image: "images/products/img23.jpg",
        productName: "rose blouse",
        price: "$12",
        category: "Blouses",
        quantity: 1
    },
    {
        id: 24,
        image: "images/products/img24.jpg",
        productName: "sporting shoes",
        price: "$15",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 25,
        image: "images/products/img25.jpg",
        productName: "pink glasses",
        price: "$6",
        category: "Accessories",
        quantity: 1
    }
    ,
    {
        id: 26,
        image: "images/products/img26.jpg",
        productName: "black bag",
        price: "$9",
        category: "Bags",
        quantity: 1
    },
    {
        id: 27,
        image: "images/products/img27.webp",
        productName: "jeans pants",
        price: "$10",
        category: "Pants",
        quantity: 1
    },
    {
        id: 28,
        image: "images/products/img28.jpg",
        productName: "mass rings",
        price: "$10",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 29,
        image: "images/products/img29.jpg",
        productName: "ring",
        price: "$5",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 30,
        image: "images/products/img30.jpg",
        productName: "pinky pants",
        price: "$9",
        category: "Pants",
        quantity: 1
    },
    {
        id: 31,
        image: "images/products/img31.jpg",
        productName: "flower dress",
        price: "$9",
        category: "Dresses",
        quantity: 1
    },
    {
        id: 32,
        image: "images/products/img32.jpg",
        productName: "black glasses",
        price: "$6",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 33,
        image: "images/products/img33.jpg",
        productName: "bracelet",
        price: "$7",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 34,
        image: "images/products/img34.webp",
        productName: "bink blouse",
        price: "$12",
        category: "Blouses",
        quantity: 1
    },
    {
        id: 35,
        image: "images/products/img35.jpg",
        productName: "meky necklace",
        price: "$9",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 36,
        image: "images/products/img36.jpg",
        productName: "pinky glasses",
        price: "$8",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 37,
        image: "images/products/img37.webp",
        productName: "jeans blouse",
        price: "$10",
        category: "Blouses",
        quantity: 1
    }
    ,
    {
        id: 38,
        image: "images/products/img38.jpg",
        productName: "blue dress",
        price: "$10",
        category: "Dresses",
        quantity: 1
    },
    {
        id: 39,
        image: "images/products/img39.jpg",
        productName: "caro dress",
        price: "$11",
        category: "Dresses",
        quantity: 1
    },
    {
        id: 40,
        image: "images/products/img40.jpg",
        productName: "almas ring",
        price: "$10",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 41,
        image: "images/products/img41.jpg",
        productName: "orange bag",
        price: "$10",
        category: "Bags",
        quantity: 1
    },
    {
        id: 42,
        image: "images/products/img42.jpg",
        productName: "black heels",
        price: "$12",
        category: "Shoes",
        quantity: 1
    },
    {
        id: 43,
        image: "images/products/img43.jpg",
        productName: "grey glasses",
        price: "$6",
        category: "Accessories",
        quantity: 1
    },
    {
        id: 44,
        image: "images/products/img44.jpg",
        productName: "purble dress",
        price: "$14",
        category: "Dresses",
        quantity: 1
    }
]
// localStorage.setItem("myProducts", JSON.stringify(products))

///////////////////End Array Of Products/////////////////////


//////////////////////////////////////////////////////
//Variables 
const cartShopping = document.getElementById("cart-shopping")
const menuCart = document.querySelector(".menuCart")
const addedProducts = document.querySelector(".addedProducts")
const bedge = document.querySelector(".bedge")
const close = document.querySelector(".close")


const productSection = document.querySelector(".allProducts")
const buttons = document.querySelectorAll("button")
const filterBtns = document.querySelector(".filterBtns")
const searchInput = document.getElementById("search")

////////////////////////////////////////////


////////////////////////////////////////////
//Show Products
function displayProducts(products) {
    let productsUI = ""
    products.forEach((product) => {
        productsUI += `
        <div class="box">
            <span class="favorite"> <i class="fa fa-heart" style="color:${product.liked ? 'rgb(241, 83, 109)' : 'black'}" onclick="addToFavorite(${product.id})"></i></span>
            <div class="image">
                 <img src="${product.image}" alt="">
            </div>
            <div class="content">
                <h3 onclick="saveProductData(${product.id})">${product.productName}</h3>
                <div class="price"> ${product.price} </div>
                <button class="cart-btn" id="addCart"  onclick="addToCart(${product.id})">add to cart</button>
            </div>
        </div>
        `
    })

    productSection.innerHTML = productsUI
}
displayProducts(JSON.parse(localStorage.getItem("myProducts")) || products)
////////////////////////////////////////////

////////////////////////////////////////////
//Filteration Products

buttons.forEach(btn => {
    btn.addEventListener("click", () => {
        //active button
        buttons.forEach(btn => {
            btn.classList.remove('active');
        });
        btn.classList.add('active');
    })
})

let clicked;
filterBtns.addEventListener("click", filterProduct)
function filterProduct(e) {
    clicked = e.target
    if (clicked.classList.contains("filter-btn")) {

        //all button display all products
        if (clicked.innerHTML == "All") {
            displayProducts(products)
        }

        //filter products by category
        else {
            let filteredProducts = products.filter((product) => product.category === clicked.innerHTML)
            displayProducts(filteredProducts)
        }
    }

}


//Search By Name
searchInput.addEventListener("input", searchFilterProducts)

function searchFilterProducts() {
    const value = searchInput.value.toLowerCase();

    const filteredProducts = products.filter(product => {
        const productName = product.productName.toLowerCase();
        return productName.includes(value);
    }).filter(product => {
        if (clicked && clicked.innerHTML !== "All") {
            return product.category === clicked.innerHTML;
        } else {
            return true;
        }
    });

    displayProducts(filteredProducts);
}

////////////////////////////////////////////

//////////////////////////////////////////
//Add To cart
//check if there products in localstorage
let addedProductsArr = localStorage.getItem("productsInCart")
    ? JSON.parse(localStorage.getItem("productsInCart"))
    : []


addedProductsArr.forEach(product => addedProducts.innerHTML += `<p>${product.productName} ${product.quantity}</p>`)

bedge.innerHTML = addedProductsArr.length

//Add Product To cart
function addToCart(productID) {

    if (localStorage.getItem("userName")) {

        let choosenProduct = products.find((product) => product.id === productID)
        let isProductInCart = addedProductsArr.some((item) => item.id === choosenProduct.id)

        if (isProductInCart) {
            addedProductsArr = addedProductsArr.map(product => {
                if (product.id === choosenProduct.id)
                    product.quantity += 1
                return product
            })
        }

        else {
            addedProductsArr.push(choosenProduct)
        }

        addedProducts.innerHTML = " "
        addedProductsArr.forEach(p => {
            addedProducts.innerHTML += `<p>${p.productName} ${p.quantity}</p>`
        });

        localStorage.setItem("productsInCart", JSON.stringify(addedProductsArr))

        const cartProductItems = document.querySelectorAll(".addedProducts p")
        bedge.innerHTML = cartProductItems.length

    }

    else {
        window.location = 'signup.html'
    }
}

/////////////////////////////////////////////////////////////

//Open or Close Cart Menu
function openMenucart() {
    menuCart.classList.toggle("open")
}

cartShopping.addEventListener("click", openMenucart)
close.addEventListener("click", openMenucart)


/////////////////////////////
//For Get Product Details

function saveProductData(id) {
    localStorage.setItem('productID', id)
    window.location = "productDetails.html"
}


//////////////////////////////
//Add To Favorite
let favProductsArr = localStorage.getItem("favProducts")
    ? JSON.parse(localStorage.getItem("favProducts"))
    : []


// Update the 'liked' property in the 'products' array based on the favorites in the local storage
products = products.map(product => ({
    ...product,
    liked: favProductsArr.some(item => item.id === product.id)
}));

// Function to add a product to favorites
function addToFavorite(productID) {
    if (localStorage.getItem("userName")) {
        const favChoosenProduct = products.find(product => product.id === productID);

        if (!favChoosenProduct.liked) {
            favProductsArr.push(favChoosenProduct);
            localStorage.setItem("favProducts", JSON.stringify(favProductsArr));
        }

        products = products.map(product => {
            if (product.id === favChoosenProduct.id) {
                return { ...product, liked: true };
            } else {
                return product;
            }
        });

        localStorage.setItem("myProducts", JSON.stringify(products));

        displayProducts(JSON.parse(localStorage.getItem("myProducts")));

        searchFilterProducts()

    } else {
        window.location = 'signup.html';
    }
}
